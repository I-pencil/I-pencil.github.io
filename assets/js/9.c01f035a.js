(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{389:function(t,s,a){t.exports=a.p+"assets/img/01.6556532b.png"},390:function(t,s,a){t.exports=a.p+"assets/img/02.74ed55b0.png"},391:function(t,s,a){t.exports=a.p+"assets/img/03.0dbfe16e.gif"},392:function(t,s,a){t.exports=a.p+"assets/img/06.f6756469.png"},393:function(t,s,a){t.exports=a.p+"assets/img/07.d6c9607a.png"},394:function(t,s,a){t.exports=a.p+"assets/img/12.484ab1e8.png"},395:function(t,s,a){t.exports=a.p+"assets/img/11.464b54ff.png"},396:function(t,s,a){t.exports=a.p+"assets/img/08.73700577.png"},397:function(t,s,a){t.exports=a.p+"assets/img/10.6bb5e767.png"},398:function(t,s,a){t.exports=a.p+"assets/img/09.56ab9aa4.png"},592:function(t,s,a){"use strict";a.r(s);var n=a(11),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("p",[n("a",{attrs:{href:"https://github.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub"),n("OutboundLink")],1),t._v(" 能托管软件项目,对个人开发者来说十分友好，并且它还提供了"),n("a",{attrs:{href:"https://pages.github.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub Pages"),n("OutboundLink")],1),t._v(" 功能，让我们可以搭建我们自己的个人博客网站。")]),t._v(" "),n("h2",{attrs:{id:"关联账户"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#关联账户"}},[t._v("#")]),t._v(" 关联账户")]),t._v(" "),n("p",[t._v("既然是构建自己的博客网站，就首先要有博客仓库，并且将仓库托管到"),n("code",[t._v("GitHub")]),t._v("上。这里是使用"),n("a",{attrs:{href:"https://www.vuepress.cn/",target:"_blank",rel:"noopener noreferrer"}},[t._v("VuePress"),n("OutboundLink")],1),t._v("来搭建我们的博客。")]),t._v(" "),n("p",[t._v("然后在"),n("a",{attrs:{href:"https://circleci.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("CircleCI"),n("OutboundLink")],1),t._v("上，用 "),n("em",[n("strong",[t._v("GitHub账号")])]),t._v(" 登录"),n("code",[t._v("CircleCI")]),t._v("。登录后，就可以将我们的"),n("code",[t._v("GitHub")]),t._v("仓库和"),n("code",[t._v("CircleCI")]),t._v("连接起来")]),t._v(" "),n("p",[n("img",{attrs:{src:a(389),alt:"image from dependency"}})]),t._v(" "),n("h2",{attrs:{id:"添加-ssh-密钥"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#添加-ssh-密钥"}},[t._v("#")]),t._v(" 添加 ssh 密钥")]),t._v(" "),n("ol",[n("li",[t._v("创建密钥")])]),t._v(" "),n("p",[t._v("通常我们都是使用"),n("code",[t._v("ssh-keygen -t rsa")]),t._v("创建公钥("),n("code",[t._v(".pub")]),t._v(")和私钥，但是在"),n("code",[t._v("CircleCI")]),t._v("上添加密钥时会报错：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(390),alt:"image from dependency"}})]),t._v(" "),n("p",[t._v("然后官网提供了"),n("a",{attrs:{href:"https://circleci.com/docs/2.0/add-ssh-key/",target:"_blank",rel:"noopener noreferrer"}},[t._v("方案"),n("OutboundLink")],1),t._v(":")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[t._v("ssh-keygen -m PEM -t rsa -C "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"email@example.com"')]),t._v("\n")])])]),n("ol",{attrs:{start:"2"}},[n("li",[t._v("添加密钥")])]),t._v(" "),n("p",[t._v("生成了"),n("code",[t._v("ssh")]),t._v("密钥后，我们需要将密钥添加到"),n("code",[t._v("CircleCI")]),t._v("上，将公钥添加到"),n("code",[t._v("GitHub")]),t._v("上。")]),t._v(" "),n("p",[n("code",[t._v("GitHub")]),t._v("添加公钥就不说了，这里只说"),n("code",[t._v("CircleCI")]),t._v("添加密钥。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(391),alt:"image from dependency"}})]),t._v(" "),n("blockquote",[n("p",[t._v("添加密钥时， Hostname 需要填 github.com")])]),t._v(" "),n("p",[t._v("密钥添加完后，就可以看到列表这里有了内容：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(392),alt:"image from dependency"}})]),t._v(" "),n("p",[n("code",[t._v("GitHub")]),t._v("添加完后：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(393),alt:"image from dependency"}})]),t._v(" "),n("p",[t._v("可以看到"),n("code",[t._v("CircleCI")]),t._v("和"),n("code",[t._v("GitHub")]),t._v("上"),n("code",[t._v("fingerprints")]),t._v("是相同的。")]),t._v(" "),n("p",[t._v("其中，"),n("code",[t._v("fingerprints")]),t._v("我们是需要添加到构建步骤里的:")]),t._v(" "),n("div",{staticClass:"language-yml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("add_ssh_keys")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fingerprints")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"80:b8:2a:XX:XX:XX:XX:XX:6c:28"')]),t._v("\n")])])]),n("h2",{attrs:{id:"构建配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#构建配置"}},[t._v("#")]),t._v(" 构建配置")]),t._v(" "),n("p",[t._v("在项目根目录下新建文件夹"),n("code",[t._v(".circleci")]),t._v("，然后再新建两个文件，目录就是这样：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("|-- blog // 项目名称\n  |--.circleci\n      |-- config.yml\n      |-- deploy.sh\n\n")])])]),n("p",[t._v("其中，"),n("code",[t._v("config.yml")]),t._v("文件是配置文件，"),n("code",[t._v("deploy.sh")]),t._v("是部署脚本.")]),t._v(" "),n("p",[t._v("部署脚本在"),n("code",[t._v("VuePress")]),t._v("有"),n("a",{attrs:{href:"https://www.vuepress.cn/guide/deploy.html#github-pages",target:"_blank",rel:"noopener noreferrer"}},[t._v("教程"),n("OutboundLink")],1),t._v(":")]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#!/usr/bin/env sh")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 终止一个错误")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" -e\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 构建")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run build\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 进入生成的构建文件夹")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" blog/.vuepress/dist\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果你是要部署到自定义域名")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# echo 'www.example.com' > CNAME")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" init\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" -A\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" commit -m "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'deploy'")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"before push"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果你想要部署到 https://<USERNAME>.github.io")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" push -f git@github.com:"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("USERNAME"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("USERNAME"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(".github.io.git master\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"after push"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" -\n")])])]),n("p",[t._v("然后在"),n("code",[t._v("CircleCI")]),t._v("里可以看到部署任务列表和部署详情：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(394),alt:"image from dependency"}})]),t._v(" "),n("p",[n("img",{attrs:{src:a(395),alt:"image from dependency"}})]),t._v(" "),n("h2",{attrs:{id:"遇到的问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#遇到的问题"}},[t._v("#")]),t._v(" 遇到的问题")]),t._v(" "),n("h4",{attrs:{id:"_1-the-authenticity-of-host-github-com-can-t-be-established"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-the-authenticity-of-host-github-com-can-t-be-established"}},[t._v("#")]),t._v(" 1. The authenticity of host 'github.com' can't be established")]),t._v(" "),n("p",[t._v("当"),n("code",[t._v("CircleCI")]),t._v("服务器尝试连接到"),n("code",[t._v("GitHub")]),t._v("的主机时，它可能会提示验证主机密钥。提示是自动化的氪星石：CI环境将无限期挂起，等待用户给出响应。这时我们就只能取消"),n("code",[t._v("Job")]),t._v("：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(396),alt:"image from dependency"}})]),t._v(" "),n("p",[n("strong",[t._v("解决方法：")])]),t._v(" "),n("div",{staticClass:"language-yml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ssh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("keyscan github.com "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" ~/.ssh/known_hosts\n")])])]),n("h4",{attrs:{id:"_2-github-does-not-provide-shell-access"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-github-does-not-provide-shell-access"}},[t._v("#")]),t._v(" 2. GitHub does not provide shell access")]),t._v(" "),n("p",[t._v("这里我们需要执行脚本，但是"),n("code",[t._v("GitHub")]),t._v("可能会提示没有权限。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(397),alt:"image from dependency"}})]),t._v(" "),n("p",[n("strong",[t._v("解决方法：")])]),t._v(" "),n("div",{staticClass:"language-yml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" get bash permission\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" chmod 755 ./.circleci/deploy.sh\n")])])]),n("h4",{attrs:{id:"_3-git-配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-git-配置"}},[t._v("#")]),t._v(" 3. git 配置")]),t._v(" "),n("p",[n("img",{attrs:{src:a(398),alt:"image from dependency"}})]),t._v(" "),n("p",[t._v("这个简单，只需要按照提示，在部署脚本里加上"),n("code",[t._v("Git")]),t._v("配置就可以了。")]),t._v(" "),n("h2",{attrs:{id:"最终部署脚本"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#最终部署脚本"}},[t._v("#")]),t._v(" 最终部署脚本")]),t._v(" "),n("ul",[n("li",[t._v("config.yml")])]),t._v(" "),n("div",{staticClass:"language-yml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("working_directory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /tmp/workspace\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("docker")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" circleci/node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" bash"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("4.4.19\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(' echo "==============构建开始=================="\n      '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" checkout\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" sudo apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("get update\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" sudo apt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("get install git\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Update npm\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sudo npm install -g npm@latest'")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restore_cache")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" dependency"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(' checksum "package.json" '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Install npm dep\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" npm install\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("save_cache")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" dependency"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(' checksum "package.json" '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" node_modules\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("persist_to_workspace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("root")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" .\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("paths")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./*\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(' echo "==============构建完成=================="\n  '),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("deploy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("working_directory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /tmp/workspace\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("docker")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" circleci/node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" bash"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("4.4.19\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("add_ssh_keys")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fingerprints")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"80:b8:2a:XX:XX:XX:XX:XX:6c:28"')]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(' echo "==============部署开始=================="\n      '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ssh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("keyscan github.com "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" ~/.ssh/known_hosts\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("attach_workspace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("at")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /tmp/workspace\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" pwd "),n("span",{pre:!0,attrs:{class:"token important"}},[t._v("&&")]),t._v(" ls "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("al\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" get bash permission\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" chmod 755 ./.circleci/deploy.sh\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deploy Over SSH\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ./.circleci/deploy.sh\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(' echo "==============部署完成=================="\n\n'),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("workflows")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build_and_deploy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" build\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("deploy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("requires")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" build\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filters")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("branches")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("only")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" release\n")])])]),n("blockquote",[n("p",[t._v("这里我使用 release 分支作为部署分支，因为使用 VuePress 时，构建后，项目的目录会不同，然后 push 到 master 分支后，项目就改变了。再次 push 时，它会要求我们先从 master 分支上 pull 最新代码，这不是我想要的结果，所以用 release 分支作为部署分支。")])]),t._v(" "),n("ul",[n("li",[t._v("deploy.sh")])]),t._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#!/usr/bin/env sh")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 终止一个错误")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" -e\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" config --global user.email "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"you@example.com"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" config --global user.name "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"your name"')]),t._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 构建")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run build\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 进入生成的构建文件夹")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" blog/.vuepress/dist\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果你是要部署到自定义域名")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# echo 'www.example.com' > CNAME")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" init\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" -A\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" commit -m "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'deploy'")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"before push"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果你想要部署到 https://<USERNAME>.github.io")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" push -f git@github.com:"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("USERNAME"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("USERNAME"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(".github.io.git master\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"after push"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" -\n")])])]),n("p",[t._v("配置好了之后，我们每次"),n("code",[t._v("push")]),t._v("代码到"),n("code",[t._v("release")]),t._v("分支时，就会自动构建啦，打开我们的个人"),n("code",[t._v("GitHub Pages")]),t._v("网站时，就可以看到我们的博客网站啦。")])])}),[],!1,null,null,null);s.default=e.exports}}]);