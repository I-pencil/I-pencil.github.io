(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{506:function(t,s,a){t.exports=a.p+"assets/img/01.acd6696a.png"},609:function(t,s,a){"use strict";a.r(s);var e=a(11),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h2",{attrs:{id:"一、同源策略"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一、同源策略"}},[t._v("#")]),t._v(" 一、同源策略")]),t._v(" "),e("h3",{attrs:{id:"_1-1-含义"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-含义"}},[t._v("#")]),t._v(" 1.1 含义")]),t._v(" "),e("p",[t._v("同源策略要求源相同才能正常进行通信，"),e("em",[e("strong",[t._v("即协议、域名和端口号都完全一致")])]),t._v("。")]),t._v(" "),e("p",[t._v("同源策略的目的是为了保证用户信息的安全，防止恶意的网站窃取数据。")]),t._v(" "),e("h3",{attrs:{id:"_1-2-限制范围"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-限制范围"}},[t._v("#")]),t._v(" 1.2 限制范围")]),t._v(" "),e("p",[t._v("目前，如果非同源，共有三种行为受到限制：")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("Cookie")]),t._v("、"),e("code",[t._v("LocalStorage")]),t._v("和"),e("code",[t._v("IndexDB")]),t._v("无法读取。")]),t._v(" "),e("li",[e("code",[t._v("DOM")]),t._v("无法获得。")]),t._v(" "),e("li",[e("code",[t._v("Ajax")]),t._v("请求不能发送。")])]),t._v(" "),e("p",[t._v("但是有三个标签是允许跨域加载资源：")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("<img src=XXX>")])]),t._v(" "),e("li",[e("code",[t._v("<link href=XXX>")])]),t._v(" "),e("li",[e("code",[t._v("<script src=XXX>")])])]),t._v(" "),e("p",[e("code",[t._v("home.com")]),t._v("加载的"),e("code",[t._v("cdn.home.com/index.js")]),t._v("可以向"),e("code",[t._v("home.com")]),t._v("发请求而不会跨域，这是因为"),e("code",[t._v("home.com")]),t._v("加载的"),e("code",[t._v("JS")]),t._v("是工作在"),e("code",[t._v("home.com")]),t._v("的，它的源不是提供"),e("code",[t._v("JS")]),t._v("的"),e("code",[t._v("cdn")]),t._v("，所以这个时候是没有跨域的问题的，==并且"),e("code",[t._v("script")]),t._v("标签能够加载非同源的资源，不受同源策略的影响。==")]),t._v(" "),e("p",[t._v("为什么限制"),e("code",[t._v("DOM")]),t._v("读取？")]),t._v(" "),e("p",[t._v("如果不限制的话，那么很容易就可以伪装其他的网站，如套一个"),e("code",[t._v("iframe")]),t._v("或者通过"),e("code",[t._v("window.open")]),t._v("方法，从而得到用户的操作和输入，如账户、密码。")]),t._v(" "),e("p",[t._v("添加这个"),e("code",[t._v("HTTP")]),t._v("头可以限制别人把你的网站套成它的"),e("code",[t._v("iframe")]),t._v("：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("X-Frame-Options:SAMEORIGIN\n")])])]),e("h2",{attrs:{id:"二、什么是跨域"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二、什么是跨域"}},[t._v("#")]),t._v(" 二、什么是跨域")]),t._v(" "),e("p",[t._v("跨域是因为同源策略的限制。")]),t._v(" "),e("p",[t._v("跨域分为两种，一种是跨域请求，另一种访问跨域的页面，跨域请求可以通过"),e("code",[t._v("CORS/JSONP")]),t._v("等方法进行访问，跨域的页面主要通过"),e("code",[t._v("postMesssage")]),t._v("的方式。")]),t._v(" "),e("h3",{attrs:{id:"_2-1-跨域误区"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-跨域误区"}},[t._v("#")]),t._v(" 2.1 跨域误区")]),t._v(" "),e("p",[t._v("关于跨域的误区：")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("错误：动态请求就会有跨域的问题。")]),t._v(" "),e("p",[t._v("正确：跨域只存在于浏览器端，不存在与安卓"),e("code",[t._v("/ios/Node.js/python/ java")]),t._v("等其它环境。")])]),t._v(" "),e("li",[e("p",[t._v("错误：跨域就是请求发不出去。")]),t._v(" "),e("p",[t._v("正确：跨域请求能发出去，服务器端能收到请求并正常返回结果，只是结果被浏览器拦截了。")])])]),t._v(" "),e("p",[t._v("规避同源策略有如下几种方法。")]),t._v(" "),e("h3",{attrs:{id:"_2-2-跨域方法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-跨域方法"}},[t._v("#")]),t._v(" 2.2 跨域方法")]),t._v(" "),e("ul",[e("li",[t._v("Cookie")]),t._v(" "),e("li",[t._v("iframe")]),t._v(" "),e("li",[t._v("Ajax")])]),t._v(" "),e("h2",{attrs:{id:"三、cookie"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三、cookie"}},[t._v("#")]),t._v(" 三、Cookie")]),t._v(" "),e("p",[e("code",[t._v("Cookie")]),t._v("是服务器写入浏览器的一小段信息，只有同源的网页才能共享。但是，两个网页一级域名相同，只是二级域名不同，浏览器允许通过设置"),e("code",[t._v("document.domain")]),t._v("共享"),e("code",[t._v("Cookie")]),t._v("。")]),t._v(" "),e("p",[t._v("比如："),e("code",[t._v("A")]),t._v("网页是"),e("code",[t._v("http://w1.example.com/a.html")]),t._v("，"),e("code",[t._v("B")]),t._v("网页是"),e("code",[t._v("http://w2.example.com/b.html")]),t._v("，那么只要设置相同的"),e("code",[t._v("document.domain")]),t._v("，两个网页就可以共享"),e("code",[t._v("Cookie")]),t._v("。")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("document"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'example.com'")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// A网页设置Cookie")]),t._v("\ndocument"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello world'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// B网页可以读取到Cookie")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" cookieA "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("==注意，"),e("code",[t._v("Cookie")]),t._v("方法只适用于"),e("code",[t._v("Cookie")]),t._v("和"),e("code",[t._v("iframe")]),t._v(" 窗口，"),e("code",[t._v("LocalStorage")]),t._v("和"),e("code",[t._v("IndexDB")]),t._v(" 无法通过这种方法==，规避同源策略，而要使用"),e("code",[t._v("PostMessage API")]),t._v("。")]),t._v(" "),e("p",[t._v("另外，服务器也可以在设置"),e("code",[t._v("Cookie")]),t._v("的时候，指定"),e("code",[t._v("Cookie")]),t._v("的所属域名为一级域名，比如"),e("code",[t._v(".example.com")]),t._v("。")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("Set-Cookie: key=value; domain=.example.com; path=/\n")])])]),e("p",[t._v("这样的话，二级域名和三级域名不用做任何设置，都可以读取这个"),e("code",[t._v("Cookie")]),t._v("。")]),t._v(" "),e("p",[t._v("关于"),e("code",[t._v("cookie")]),t._v("还有两个地方值得注意，如下图所示：")]),t._v(" "),e("p",[e("img",{attrs:{src:a(506),alt:"image from dependency"}})]),t._v(" "),e("h2",{attrs:{id:"四、iframe"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#四、iframe"}},[t._v("#")]),t._v(" 四、iframe")]),t._v(" "),e("p",[e("code",[t._v("iframe")]),t._v("访问父页面可通过"),e("code",[t._v("window.parent")]),t._v("得到父窗口的"),e("code",[t._v("window")]),t._v("对象，通过"),e("code",[t._v("window.open")]),t._v("打开的页面可以用"),e("code",[t._v("window.opener")]),t._v("，进而得到父窗口的任何东西；")]),t._v(" "),e("ol",[e("li",[t._v("父窗口如果和"),e("code",[t._v("iframe")]),t._v("同源的，那么可通过"),e("code",[t._v("iframe.contentWindow")]),t._v("得到"),e("code",[t._v("iframe")]),t._v("的"),e("code",[t._v("window")]),t._v("对象，")]),t._v(" "),e("li",[t._v("如果和"),e("code",[t._v("iframe")]),t._v("不同源，则存在跨域的问题，目前有三种方法解决跨域：")])]),t._v(" "),e("ul",[e("li",[t._v("片段识别符（"),e("code",[t._v("fragment identifier")]),t._v("）")]),t._v(" "),e("li",[e("code",[t._v("window.name")])]),t._v(" "),e("li",[t._v("跨文档通信"),e("code",[t._v("API")]),t._v("（"),e("code",[t._v("Cross-document messaging")]),t._v("）")])]),t._v(" "),e("h3",{attrs:{id:"_4-1-片段识别符"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-片段识别符"}},[t._v("#")]),t._v(" 4.1 片段识别符")]),t._v(" "),e("p",[t._v("片段识别符指的是"),e("code",[t._v("URL")]),t._v("的"),e("code",[t._v("#")]),t._v("号后面的部分，如果只是改变片段标识符，页面不会重新刷新。")]),t._v(" "),e("p",[t._v("父窗口可以把信息写入子窗口的片段标识符：")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" src "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" origin "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" data"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndocument"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'myIframe'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" src"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("子窗口通过监听"),e("code",[t._v("hashchange")]),t._v("事件得到通知:")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("window"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("onhashchange "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" checkMessage"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("checkMessage")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" message "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" window"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hash"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("子窗口也可以改变父窗口的片段标识符：")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("parent"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("href "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" target "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" hash"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("h3",{attrs:{id:"_4-2-window-name"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-window-name"}},[t._v("#")]),t._v(" 4.2 window.name")]),t._v(" "),e("p",[t._v("浏览器窗口有"),e("code",[t._v("window.name")]),t._v("属性。这个属性的最大特点是，无论是否同源，只要在同一个窗口里，前一个网页设置了这个属性，后一个网页可以读取它。")]),t._v(" "),e("p",[t._v("父窗口先打开一个子窗口，载入一个不同源的网页，该网页将信息写入"),e("code",[t._v("window.name")]),t._v("属性。")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("window"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" data"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("接着，子窗口跳回一个与主窗口同域的网址。")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("location "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://parent.url.com/xxx.html'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("然后，主窗口就可以读取子窗口的"),e("code",[t._v("window.name")]),t._v("了。")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" data "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'myFrame'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("contentWindow"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("==这种方法的优点是，"),e("code",[t._v("window.name")]),t._v("容量很大，可以放置非常长的字符串；缺点是必须监听子窗口"),e("code",[t._v("window.name")]),t._v("属性的变化，影响网页性能。==")]),t._v(" "),e("h3",{attrs:{id:"_4-3-window-postmessage"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-window-postmessage"}},[t._v("#")]),t._v(" 4.3 "),e("code",[t._v("window.postMessage")])]),t._v(" "),e("p",[t._v("跨文档通信"),e("code",[t._v("API")]),t._v("为"),e("code",[t._v("window")]),t._v("对象新增了一个"),e("code",[t._v("window.postMessage")]),t._v("方法，允许跨窗口通信，不论这两个窗口是否同源。")]),t._v(" "),e("p",[e("code",[t._v("postMessage")]),t._v("方法的第一个参数是具体的信息内容，第二个参数是接收消息的窗口的源（"),e("code",[t._v("origin")]),t._v('），即"协议'),e("code",[t._v("+")]),t._v("域名"),e("code",[t._v("+")]),t._v(' 端口"。也可以设为'),e("code",[t._v("*")]),t._v("，表示不限制域名，向所有窗口发送。")]),t._v(" "),e("p",[t._v("子窗口向父窗口发送消息:")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("window"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("opener"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Nice to see you'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://aaa.com'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("由于"),e("code",[t._v("script/iframe/img")]),t._v("等标签的请求是能带上"),e("code",[t._v("cookie")]),t._v("，用这些标签发请求是能绕过同源策略，因此就可以利用这些标签做==跨站请求伪造==（"),e("code",[t._v("CSRF")]),t._v("），代码如下：")]),t._v(" "),e("div",{staticClass:"language-html extra-class"},[e("pre",{pre:!0,attrs:{class:"language-html"}},[e("code",[t._v("// 转账请求\n"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("iframe")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[e("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://Abank.com/app/transferFunds?amount=1500&destinationAccount=..."),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("iframe")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n// 配置路由器添加代理\n"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("img")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[e("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://192.168.1.1/admin/config/outsideInterface?nexthop=123.45.67.89"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token style-attr"}},[e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("style")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[e("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),e("span",{pre:!0,attrs:{class:"token style language-css"}},[e("span",{pre:!0,attrs:{class:"token property"}},[t._v("display")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("none")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n")])])]),e("p",[t._v("如果相应的网站支持"),e("code",[t._v("GET")]),t._v("请求，或者没有做进一步的防护措施，那么如果用户在另外一个页面登陆过了，再打开一个“有毒”的网站就中招了。")]),t._v(" "),e("h3",{attrs:{id:"_4-4-localstorage"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-localstorage"}},[t._v("#")]),t._v(" 4.4 LocalStorage")]),t._v(" "),e("p",[t._v("通过"),e("code",[t._v("window.postMessage")]),t._v("，读写其他窗口的"),e("code",[t._v("LocalStorage")]),t._v(" 也成为了可能。")]),t._v(" "),e("p",[t._v("下面是一个例子：")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 父窗口发送消息")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" win "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementsByTagName")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'iframe'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("contentWindow"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" obj "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" name"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Jack'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 存入对象")]),t._v("\nwin"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("key"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'storage'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" method"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'set'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" obj"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://bbb.com'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 读取对象")]),t._v("\nwin"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("key"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'storage'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" method"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"get"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nwindow"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onmessage")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("origin "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://aaa.com'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// "Jack"')]),t._v("\n  console"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("parse")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 子窗口接收消息")]),t._v("\nwindow"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onmessage")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("origin "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://bbb.com'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" payload "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("parse")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("switch")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payload"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("method"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'set'")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n      localStorage"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("setItem")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payload"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payload"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'get'")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" parent "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" window"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("parent"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" data "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" localStorage"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("getItem")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payload"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      parent"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://aaa.com'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'remove'")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n      localStorage"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeItem")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payload"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),e("h2",{attrs:{id:"五、ajax"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#五、ajax"}},[t._v("#")]),t._v(" 五、Ajax")]),t._v(" "),e("p",[t._v("同源政策规定，"),e("code",[t._v("AJAX")]),t._v("请求只能发给同源的网址，否则就报错。")]),t._v(" "),e("p",[t._v("除了架设服务器代理（浏览器请求同源服务器，再由后者请求外部服务），有三种方法规避这个限制:")]),t._v(" "),e("ol",[e("li",[e("code",[t._v("JSONP")])]),t._v(" "),e("li",[e("code",[t._v("WebSocket")])]),t._v(" "),e("li",[e("code",[t._v("CORS")])])]),t._v(" "),e("h3",{attrs:{id:"_5-1-websocket"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-websocket"}},[t._v("#")]),t._v(" 5.1 "),e("code",[t._v("WebSocket")])]),t._v(" "),e("p",[e("code",[t._v("WebSocket")]),t._v("是一种通信协议，使用"),e("code",[t._v("ws://")]),t._v("（非加密）和"),e("code",[t._v("wss://")]),t._v("（加密）作为协议前缀。该协议不实行同源策略，只要服务器支持，就可以通过它进行跨源通信。")]),t._v(" "),e("p",[t._v("补充："),e("code",[t._v("CSS")]),t._v("的字体文件是会有跨域问题，指定"),e("code",[t._v("CORS")]),t._v("就能加载其它源的字体文件（通常是放在"),e("code",[t._v("cdn")]),t._v("上的）。而"),e("code",[t._v("canvas")]),t._v("动态加载的外部"),e("code",[t._v("image")]),t._v("，也是需要指定"),e("code",[t._v("CORS")]),t._v("头才能进行图片处理，否则只能画不能读取。")]),t._v(" "),e("p",[t._v("下面是一个例子，浏览器发出的"),e("code",[t._v("WebSocket")]),t._v("请求的头信息（摘自"),e("a",{attrs:{href:"https://en.wikipedia.org/wiki/WebSocket",target:"_blank",rel:"noopener noreferrer"}},[t._v("维基百科"),e("OutboundLink")],1),t._v("）。")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("GET /chat HTTP/1.1\nHost: server.example.com\nUpgrade: websocket\nConnection: Upgrade\nSec-WebSocket-Key: x3JJHMbDL1EzLkh9GBhXDw==\nSec-WebSocket-Protocol: chat, superchat\nSec-WebSocket-Version: 13\nOrigin: http://example.com\n")])])]),e("p",[t._v("上面代码中，字段"),e("code",[t._v("Origin")]),t._v("表示该请求的请求源（"),e("code",[t._v("origin")]),t._v("），即发自哪个域名。")]),t._v(" "),e("p",[t._v("正是因为有了"),e("code",[t._v("Origin")]),t._v("字段，所以"),e("code",[t._v("WebSocket")]),t._v("才没有实行同源政策。因为服务器可以根据这个字段，判断是否许可本次通信。如果该域名在白名单内，服务器就会做出如下回应。")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("HTTP/1.1 101 Switching Protocols\nUpgrade: websocket\nConnection: Upgrade\nSec-WebSocket-Accept: HSmrc0sMlYUkAGmm5OPpG2HaGWk=\nSec-WebSocket-Protocol: chat\n")])])]),e("h3",{attrs:{id:"_5-2-jsonp"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-jsonp"}},[t._v("#")]),t._v(" 5.2 "),e("code",[t._v("JSONP")])]),t._v(" "),e("p",[e("code",[t._v("JSONP")]),t._v("是服务器与客户端跨源通信的常用方法。最大特点就是简单适用，老式浏览器全部支持，服务器改造非常小。")]),t._v(" "),e("p",[t._v("它的基本思想是，网页通过添加一个"),e("code",[t._v("<script>")]),t._v("元素，向服务器请求"),e("code",[t._v("JSON")]),t._v("数据，这种做法不受同源政策限制；服务器收到请求后，将数据放在一个指定名字的回调函数里传回来。")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateList")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n$body"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<script src=\"http://http://example.com/ip?callback=updateList\"><\/script>'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),e("p",[t._v("上面代码通过动态添加"),e("code",[t._v("<script>")]),t._v("元素，向服务器"),e("code",[t._v("example.com")]),t._v("发出请求。注意，该请求的查询字符串有一个"),e("code",[t._v("callback")]),t._v("参数，用来指定回调函数的名字，这对于"),e("code",[t._v("JSONP")]),t._v("是必需的。")]),t._v(" "),e("p",[t._v("服务器收到这个请求以后，会将数据放在回调函数的参数位置返回。")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ip"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8.8.8.8"')]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),e("p",[t._v("由于"),e("code",[t._v("<script>")]),t._v("元素请求的脚本，直接作为代码运行。这时，只要浏览器定义了"),e("code",[t._v("foo")]),t._v("函数，该函数就会立即调用。作为参数的"),e("code",[t._v("JSON")]),t._v("数据被视为"),e("code",[t._v("JavaScript")]),t._v("对象，而不是字符串，因此避免了使用"),e("code",[t._v("JSON.parse")]),t._v("的步骤。")]),t._v(" "),e("h3",{attrs:{id:"_5-3-cors"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-cors"}},[t._v("#")]),t._v(" 5.3 "),e("code",[t._v("CORS")])]),t._v(" "),e("p",[e("code",[t._v("CORS")]),t._v("即跨源资源分享（"),e("code",[t._v("Cross-Origin Resource Sharing")]),t._v("）是跨源"),e("code",[t._v("AJAX")]),t._v("请求的根本解决方法。相比"),e("code",[t._v("JSONP")]),t._v("只能发"),e("code",[t._v("GET")]),t._v("请求，"),e("code",[t._v("CORS")]),t._v("允许任何类型的请求。")]),t._v(" "),e("p",[e("code",[t._v("CORS")]),t._v("需要浏览器和服务器同时支持。目前，所有浏览器都支持该功能，"),e("code",[t._v("IE")]),t._v("浏览器不能低于"),e("code",[t._v("IE10")]),t._v("。")]),t._v(" "),e("p",[t._v("整个"),e("code",[t._v("CORS")]),t._v("通信过程，都是浏览器自动完成，不需要用户参与。")]),t._v(" "),e("p",[t._v("浏览器一旦发现"),e("code",[t._v("AJAX")]),t._v("请求跨源，就会自动添加一些附加的头信息，有时还会多出一次附加的请求，但用户不会有感觉。")]),t._v(" "),e("p",[t._v("因此，实现"),e("code",[t._v("CORS")]),t._v("通信的关键是服务器。只要服务器实现了"),e("code",[t._v("CORS")]),t._v("接口，就可以跨源通信。")]),t._v(" "),e("h4",{attrs:{id:"_5-3-1-两种请求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-1-两种请求"}},[t._v("#")]),t._v(" 5.3.1 两种请求")]),t._v(" "),e("p",[t._v("浏览器将"),e("code",[t._v("CORS")]),t._v("请求分成两类：简单请求和非简单请求。")]),t._v(" "),e("p",[t._v("只要同时满足以下两大条件，就属于简单请求。")]),t._v(" "),e("ol",[e("li",[t._v("请求方法是以下三种方法之一：")])]),t._v(" "),e("ul",[e("li",[e("code",[t._v("HEAD")])]),t._v(" "),e("li",[e("code",[t._v("GET")])]),t._v(" "),e("li",[e("code",[t._v("POST")])])]),t._v(" "),e("ol",{attrs:{start:"2"}},[e("li",[e("code",[t._v("HTTP")]),t._v("的头信息不超出以下几种字段：")])]),t._v(" "),e("ul",[e("li",[e("code",[t._v("Accept")])]),t._v(" "),e("li",[e("code",[t._v("Accept-Language")])]),t._v(" "),e("li",[e("code",[t._v("Content-Language")])]),t._v(" "),e("li",[e("code",[t._v("Last-Event-ID")])]),t._v(" "),e("li",[e("code",[t._v("Content-Type")]),t._v("：只限于三个值"),e("code",[t._v("application/x-www-form-urlencoded")]),t._v("、"),e("code",[t._v("multipart/form-data")]),t._v("、"),e("code",[t._v("text/plain")])])]),t._v(" "),e("p",[t._v("凡是不同时满足上面两个条件，就属于非简单请求。")]),t._v(" "),e("h4",{attrs:{id:"_5-2-简单请求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-简单请求"}},[t._v("#")]),t._v(" 5.2 简单请求")]),t._v(" "),e("p",[t._v("对于简单请求，浏览器直接在头信息之中，增加一个"),e("code",[t._v("Origin")]),t._v("字段。比如：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("GET /cors HTTP/1.1\nOrigin: http://api.bob.com\nHost: api.alice.com\nAccept-Language: en-US\nConnection: keep-alive\nUser-Agent: Mozilla/5.0...\n")])])]),e("p",[e("code",[t._v("Origin")]),t._v("字段用来说明，本次请求来自哪个源（协议"),e("code",[t._v("+")]),t._v("域名"),e("code",[t._v("+")]),t._v("端口）。服务器根据这个值，决定是否同意这次请求。")]),t._v(" "),e("p",[t._v("如果"),e("code",[t._v("Origin")]),t._v("指定的源，不在许可范围内，服务器会返回一个正常的"),e("code",[t._v("HTTP")]),t._v("回应。浏览器发现，这个回应的头信息没有包含"),e("code",[t._v("Access-Control-Allow-Origin")]),t._v("字段（详见下文），从而抛出一个错误，被"),e("code",[t._v("XMLHttpRequest")]),t._v("的"),e("code",[t._v("onerror")]),t._v("回调函数捕获。注意，这种错误无法通过状态码识别，因为"),e("code",[t._v("HTTP")]),t._v("回应的状态码有可能是"),e("code",[t._v("200")]),t._v("。")]),t._v(" "),e("p",[t._v("如果"),e("code",[t._v("Origin")]),t._v("指定的域名在许可范围内，服务器返回的响应，会多出几个头信息字段。")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("Access-Control-Allow-Origin: http://api.bob.com\nAccess-Control-Allow-Credentials: true\nAccess-Control-Expose-Headers: FooBar\nContent-Type: text/html; charset=utf-8\n")])])]),e("ul",[e("li",[e("code",[t._v("Access-Control-Allow-Origin")])])]),t._v(" "),e("p",[t._v("该字段是必须的。它的值要么是请求时"),e("code",[t._v("Origin")]),t._v("字段的值，要么是一个"),e("code",[t._v("*")]),t._v("，表示接受任意域名的请求。")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("Access-Control-Allow-Credentials")])])]),t._v(" "),e("p",[t._v("该字段可选。它的值是一个布尔值，表示是否允许发送"),e("code",[t._v("Cookie")]),t._v("。默认情况下，"),e("code",[t._v("Cookie")]),t._v("不包括在"),e("code",[t._v("CORS")]),t._v("请求之中。设为"),e("code",[t._v("true")]),t._v("，即表示服务器明确许可，"),e("code",[t._v("Cookie")]),t._v("可以包含在请求中，一起发给服务器。这个值也只能设为"),e("code",[t._v("true")]),t._v("，如果服务器不要浏览器发送"),e("code",[t._v("Cookie")]),t._v("，删除该字段即可。")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("Access-Control-Expose-Headers")])])]),t._v(" "),e("p",[t._v("该字段可选。"),e("code",[t._v("CORS")]),t._v("请求时，"),e("code",[t._v("XMLHttpRequest")]),t._v("对象的"),e("code",[t._v("getResponseHeader()")]),t._v("方法只能拿到"),e("code",[t._v("6")]),t._v("个基本字段："),e("code",[t._v("Cache-Control")]),t._v("、"),e("code",[t._v("Content-Language")]),t._v("、"),e("code",[t._v("Content-Type")]),t._v("、"),e("code",[t._v("Expires")]),t._v("、"),e("code",[t._v("Last-Modified")]),t._v("、"),e("code",[t._v("Pragma")]),t._v("。如果想拿到其他字段，就必须在"),e("code",[t._v("Access-Control-Expose-Headers")]),t._v("里面指定。上面的例子指定，"),e("code",[t._v("getResponseHeader('FooBar')")]),t._v("可以返回"),e("code",[t._v("FooBar")]),t._v("字段的值。")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("withCredentials")]),t._v("属性")])]),t._v(" "),e("p",[e("code",[t._v("CORS")]),t._v("请求默认不发送"),e("code",[t._v("Cookie")]),t._v("和"),e("code",[t._v("HTTP")]),t._v("认证信息。如果要把"),e("code",[t._v("Cookie")]),t._v("发到服务器，一方面要服务器同意，指定"),e("code",[t._v("Access-Control-Allow-Credentials")]),t._v("字段。")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("Access-Control-Allow-Credentials: true\n")])])]),e("p",[t._v("另一方面，开发者必须在"),e("code",[t._v("AJAX")]),t._v("请求中打开"),e("code",[t._v("withCredentials")]),t._v("属性。")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" xhr "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nxhr"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("withCredentials "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("否则，即使服务器同意发送"),e("code",[t._v("Cookie")]),t._v("，浏览器也不会发送。或者，服务器要求设置"),e("code",[t._v("Cookie")]),t._v("，浏览器也不会处理。")]),t._v(" "),e("p",[t._v("但是，如果省略"),e("code",[t._v("withCredentials")]),t._v("设置，有的浏览器还是会一起发送"),e("code",[t._v("Cookie")]),t._v("。这时，可以显式关闭"),e("code",[t._v("withCredentials")]),t._v("。")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("xhr.withCredentials = false;\n")])])]),e("p",[t._v("需要注意的是，如果要发送"),e("code",[t._v("Cookie")]),t._v("，"),e("code",[t._v("Access-Control-Allow-Origin")]),t._v("就不能设为星号，必须指定明确的、与请求网页一致的域名。同时，"),e("code",[t._v("Cookie")]),t._v("依然遵循同源政策，只有用服务器域名设置的"),e("code",[t._v("Cookie")]),t._v("才会上传，其他域名的"),e("code",[t._v("Cookie")]),t._v("并不会上传，且（跨源）原网页代码中的"),e("code",[t._v("document.cookie")]),t._v("也无法读取服务器域名下的"),e("code",[t._v("Cookie")]),t._v("。")]),t._v(" "),e("h4",{attrs:{id:"_5-3-3-非简单请求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-3-非简单请求"}},[t._v("#")]),t._v(" 5.3.3 非简单请求")]),t._v(" "),e("p",[t._v("非简单请求是那种对服务器有特殊要求的请求，比如请求方法是"),e("code",[t._v("PUT")]),t._v("或"),e("code",[t._v("DELETE")]),t._v("，或者"),e("code",[t._v("Content-Type")]),t._v("字段的类型是"),e("code",[t._v("application/json")]),t._v("。")]),t._v(" "),e("ol",[e("li",[t._v("预检请求")])]),t._v(" "),e("p",[t._v("非简单请求的"),e("code",[t._v("CORS")]),t._v("请求，会在正式通信之前，增加一次"),e("code",[t._v("HTTP")]),t._v('查询请求，称为"预检"请求（'),e("code",[t._v("preflight")]),t._v("）。")]),t._v(" "),e("p",[t._v("，预检请求使用"),e("code",[t._v("OPTIONS")]),t._v("方式去检测当前请求是否安全，如图所示：")]),t._v(" "),e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2018/1/20/16113382cc7e75a9?imageView2/0/w/1280/h/960/format/webp/ignore-error/1",alt:"image"}})]),t._v(" "),e("p",[t._v("代码中只发了一个请求，但是在控制台可以看到两个请求，第一个就是"),e("code",[t._v("OPTIONS")]),t._v("，请求头信息如下：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("OPTIONS /cors HTTP/1.1\nOrigin: http://api.bob.com\nAccess-Control-Request-Method: PUT\nAccess-Control-Request-Headers: X-Custom-Header\nHost: api.alice.com\nAccept-Language: en-US\nConnection: keep-alive\nUser-Agent: Mozilla/5.0...\n")])])]),e("ul",[e("li",[e("code",[t._v("Access-Control-Request-Method")])])]),t._v(" "),e("p",[t._v("该字段是必须的，用来列出浏览器的"),e("code",[t._v("CORS")]),t._v("请求会用到哪些HTTP方法。")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("Access-Control-Request-Headers")])])]),t._v(" "),e("p",[t._v("该字段是一个逗号分隔的字符串，指定浏览器"),e("code",[t._v("CORS")]),t._v("请求会额外发送的头信息字段。")]),t._v(" "),e("p",[t._v('服务器收到"预检"请求以后，检查了'),e("code",[t._v("Origin")]),t._v("、"),e("code",[t._v("Access-Control-Request-Method")]),t._v("和"),e("code",[t._v("Access-Control-Request-Headers")]),t._v("字段以后，确认允许跨源请求，就可以做出回应。")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("HTTP/1.1 200 OK\nDate: Mon, 01 Dec 2008 01:15:39 GMT\nServer: Apache/2.0.61 (Unix)\nAccess-Control-Allow-Origin: http://api.bob.com\nAccess-Control-Allow-Methods: GET, POST, PUT\nAccess-Control-Allow-Headers: X-Custom-Header\nContent-Type: text/html; charset=utf-8\nContent-Encoding: gzip\nContent-Length: 0\nKeep-Alive: timeout=2, max=100\nConnection: Keep-Alive\nContent-Type: text/plain\n")])])]),e("p",[t._v("上面的"),e("code",[t._v("HTTP")]),t._v("回应中，关键的是"),e("code",[t._v("Access-Control-Allow-Origin")]),t._v("字段，表示"),e("code",[t._v("http://api.bob.com")]),t._v("可以请求数据。该字段也可以设为星号，表示同意任意跨源请求。")]),t._v(" "),e("p",[t._v('如果浏览器否定了"预检"请求，会返回一个正常的'),e("code",[t._v("HTTP")]),t._v("回应，但是没有任何"),e("code",[t._v("CORS")]),t._v("相关的头信息字段。这时，浏览器就会认定，服务器不同意预检请求，因此触发一个错误，被"),e("code",[t._v("XMLHttpRequest")]),t._v("对象的"),e("code",[t._v("onerror")]),t._v("回调函数捕获。控制台会打印出如下的报错信息。")]),t._v(" "),e("p",[t._v("服务器回应的其他"),e("code",[t._v("CORS")]),t._v("相关字段如下:")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("Access-Control-Allow-Methods: GET, POST, PUT\nAccess-Control-Allow-Headers: X-Custom-Header\nAccess-Control-Allow-Credentials: true\nAccess-Control-Max-Age: 1728000\n")])])]),e("ul",[e("li",[e("code",[t._v("Access-Control-Allow-Methods")])])]),t._v(" "),e("p",[t._v('该字段必需，它的值是逗号分隔的一个字符串，表明服务器支持的所有跨域请求的方法。注意，返回的是所有支持的方法，而不单是浏览器请求的那个方法。这是为了避免多次"预检"请求。')]),t._v(" "),e("ul",[e("li",[e("code",[t._v("Access-Control-Allow-Headers")])])]),t._v(" "),e("p",[t._v("如果浏览器请求包括"),e("code",[t._v("Access-Control-Request-Headers")]),t._v("字段，则"),e("code",[t._v("Access-Control-Allow-Headers")]),t._v('字段是必需的。它也是一个逗号分隔的字符串，表明服务器支持的所有头信息字段，不限于浏览器在"预检"中请求的字段。')]),t._v(" "),e("ul",[e("li",[e("code",[t._v("Access-Control-Allow-Credentials")])])]),t._v(" "),e("p",[t._v("该字段与简单请求时的含义相同。")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("Access-Control-Max-Age")])])]),t._v(" "),e("p",[t._v("该字段可选，用来指定本次预检请求的有效期，单位为秒。在这个有效期内就不用再发一个"),e("code",[t._v("options")]),t._v("的请求。")]),t._v(" "),e("h3",{attrs:{id:"_5-4-支持cors"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-支持cors"}},[t._v("#")]),t._v(" 5.4 支持"),e("code",[t._v("CORS")])]),t._v(" "),e("h5",{attrs:{id:"_5-4-1-nginx可以这么配"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-1-nginx可以这么配"}},[t._v("#")]),t._v(" 5.4.1 "),e("code",[t._v("Nginx")]),t._v("可以这么配：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("location / {\n    if ($request_method = 'OPTION') {\n        add_header 'Access-Control-Allow-Origin' '*';\n        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';\n        add_header 'Access-Control-Max-Age' 1728000;\n        add_header 'Content-Type' 'text/plain; charset=utf-8';\n        add_header 'Content-Length' 0;\n        return 204;\n    }\n    add_header 'Access-Control-Allow-Origin' '*';\n    add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS, PUT, DELETE';\n    add_header 'Access-Control-Allow-Headers' 'DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Content-Range,Range';\n    add_header 'Access-Control-Expose-Headers' 'DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Content-Range,Range';\n}\n")])])]),e("h4",{attrs:{id:"_5-4-2-node-js后台配置-express框架"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-2-node-js后台配置-express框架"}},[t._v("#")]),t._v(" 5.4.2 "),e("code",[t._v("Node.js")]),t._v("后台配置("),e("code",[t._v("express")]),t._v("框架)")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("app"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("all")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    res"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("header")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Origin"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    res"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("header")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Headers"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"X-Requested-With"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    res"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("header")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Access-Control-Allow-Methods"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PUT,POST,GET,DELETE,OPTIONS"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    res"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("header")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"X-Powered-By"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("' 3.2.1'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//这段仅仅为了方便返回json而已")]),t._v("\n    res"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("header")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Content-Type"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"application/json;charset=utf-8"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("method "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'OPTIONS'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//让options请求快速返回")]),t._v("\n        res"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sendStatus")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("参考文献：")]),t._v(" "),e("p",[t._v("阮一峰, "),e("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("浏览器同源政策及其规避方法"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("阮一峰, "),e("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2016/04/cors.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("跨域资源共享"),e("code",[t._v("CORS")]),t._v(" 详解"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://juejin.im/post/5a6320d56fb9a01cb64ee191",target:"_blank",rel:"noopener noreferrer"}},[t._v("我知道的跨域与安全"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://segmentfault.com/a/1190000012469713",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("ajax")]),t._v("跨域，这应该是最全的解决方案了"),e("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=n.exports}}]);